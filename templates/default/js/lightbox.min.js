(function(){var a,b,c;a=jQuery;c=(function(){function d(){this.fileLoadingImage=TemplateP+"/img/lb-loading.gif";this.fileCloseImage=TemplateP+"/img/lb-close.png";this.resizeDuration=700;this.fadeDuration=500;this.labelImage="Image";this.labelOf="of"}return d})();b=(function(){function d(e){this.options=e;this.album=[];this.currentImageIndex=void 0;this.init()}d.prototype.init=function(){this.enable();return this.build()};d.prototype.enable=function(){var e=this;return a("body").on("click","a[rel^=prettyPhoto], area[rel^=prettyPhoto]",function(f){e.start(a(f.currentTarget));return false})};d.prototype.build=function(){var e,f=this;a("<div>",{id:"lightboxOverlay"}).after(a("<div/>",{id:"lightbox"}).append(a("<div/>",{"class":"lb-outerContainer"}).append(a("<div/>",{"class":"lb-container"}).append(a("<img/>",{"class":"lb-image"}),a("<div/>",{"class":"lb-nav"}).append(a("<a/>",{"class":"lb-prev"}),a("<a/>",{"class":"lb-next"})),a("<div/>",{"class":"lb-loader"}).append(a("<a/>",{"class":"lb-cancel"}).append(a("<img/>",{src:this.options.fileLoadingImage}))))),a("<div/>",{"class":"lb-dataContainer"}).append(a("<div/>",{"class":"lb-data"}).append(a("<div/>",{"class":"lb-details"}).append(a("<span/>",{"class":"lb-caption"}),a("<span/>",{"class":"lb-number"})),a("<div/>",{"class":"lb-closeContainer"}).append(a("<a/>",{"class":"lb-close"}).append(a("<img/>",{src:this.options.fileCloseImage}))))))).appendTo(a("body"));a("#lightboxOverlay").hide().on("click",function(g){f.end();return false});e=a("#lightbox");e.hide().on("click",function(g){if(a(g.target).attr("id")==="lightbox"){f.end()}return false});e.find(".lb-outerContainer").on("click",function(g){if(a(g.target).attr("id")==="lightbox"){f.end()}return false});e.find(".lb-prev").on("click",function(g){f.changeImage(f.currentImageIndex-1);return false});e.find(".lb-next").on("click",function(g){f.changeImage(f.currentImageIndex+1);return false});e.find(".lb-loader, .lb-close").on("click",function(g){f.end();return false})};d.prototype.start=function(j){var o,e,m,h,n,f,k,l,g;a(window).on("resize",this.sizeOverlay);a("select, object, embed").css({visibility:"hidden"});a("#lightboxOverlay").width(a(document).width()).height(a(document).height()).fadeIn(this.options.fadeDuration);this.album=[];n=0;if(j.attr("rel")==="prettyPhoto"){this.album.push({link:j.attr("href"),title:j.attr("title")})}else{g=a(j.prop("tagName")+'[rel="'+j.attr("rel")+'"]');for(h=0,l=g.length;h<l;h++){m=g[h];this.album.push({link:a(m).attr("href"),title:a(m).attr("title")});if(a(m).attr("href")===j.attr("href")){n=h}}}e=a(window);k=e.scrollTop()+e.height()/10;f=e.scrollLeft();o=a("#lightbox");o.css({top:k+"px",left:f+"px"}).fadeIn(this.options.fadeDuration);this.changeImage(n)};d.prototype.changeImage=function(h){var f,g,e,i=this;this.disableKeyboardNav();g=a("#lightbox");f=g.find(".lb-image");this.sizeOverlay();a("#lightboxOverlay").fadeIn(this.options.fadeDuration);a(".loader").fadeIn("slow");g.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide();g.find(".lb-outerContainer").addClass("animating");e=new Image;e.onload=function(){f.attr("src",i.album[h].link);f.width=e.width;f.height=e.height;return i.sizeContainer(e.width,e.height)};e.src=this.album[h].link;this.currentImageIndex=h};d.prototype.sizeOverlay=function(){return a("#lightboxOverlay").width(a(document).width()).height(a(document).height())};d.prototype.sizeContainer=function(l,j){var o,q,r,p,h,i,m,e,g,n,f,k=this;q=a("#lightbox");r=q.find(".lb-outerContainer");f=r.outerWidth();n=r.outerHeight();o=q.find(".lb-container");m=parseInt(o.css("padding-top"),10);i=parseInt(o.css("padding-right"),10);p=parseInt(o.css("padding-bottom"),10);h=parseInt(o.css("padding-left"),10);g=l+h+i;e=j+m+p;if(g!==f&&e!==n){r.animate({width:g,height:e},this.options.resizeDuration,"swing")}else{if(g!==f){r.animate({width:g},this.options.resizeDuration,"swing")}else{if(e!==n){r.animate({height:e},this.options.resizeDuration,"swing")}}}setTimeout(function(){q.find(".lb-dataContainer").width(g);q.find(".lb-prevLink").height(e);q.find(".lb-nextLink").height(e);k.showImage()},this.options.resizeDuration)};d.prototype.showImage=function(){var e;e=a("#lightbox");e.find(".lb-loader").hide();e.find(".lb-image").fadeIn("slow");this.updateNav();this.updateDetails();this.preloadNeighboringImages();this.enableKeyboardNav()};d.prototype.updateNav=function(){var e;e=a("#lightbox");e.find(".lb-nav").show();if(this.currentImageIndex>0){e.find(".lb-prev").show()}if(this.currentImageIndex<this.album.length-1){e.find(".lb-next").show()}};d.prototype.updateDetails=function(){var e,f=this;e=a("#lightbox");if(typeof this.album[this.currentImageIndex].title!=="undefined"&&this.album[this.currentImageIndex].title!==""){e.find(".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn("fast")}if(this.album.length>1){e.find(".lb-number").html(this.options.labelImage+" "+(this.currentImageIndex+1)+" "+this.options.labelOf+"  "+this.album.length).fadeIn("fast")}else{e.find(".lb-number").hide()}e.find(".lb-outerContainer").removeClass("animating");e.find(".lb-dataContainer").fadeIn(this.resizeDuration,function(){return f.sizeOverlay()})};d.prototype.preloadNeighboringImages=function(){var f,e;if(this.album.length>this.currentImageIndex+1){f=new Image;f.src=this.album[this.currentImageIndex+1].link}if(this.currentImageIndex>0){e=new Image;e.src=this.album[this.currentImageIndex-1].link}};d.prototype.enableKeyboardNav=function(){a(document).on("keyup.keyboard",a.proxy(this.keyboardAction,this))};d.prototype.disableKeyboardNav=function(){a(document).off(".keyboard")};d.prototype.keyboardAction=function(h){var j,i,f,g,e;j=27;i=37;f=39;e=h.keyCode;g=String.fromCharCode(e).toLowerCase();if(e===j||g.match(/x|o|c/)){this.end()}else{if(g==="p"||e===i){if(this.currentImageIndex!==0){this.changeImage(this.currentImageIndex-1)}}else{if(g==="n"||e===f){if(this.currentImageIndex!==this.album.length-1){this.changeImage(this.currentImageIndex+1)}}}}};d.prototype.end=function(){this.disableKeyboardNav();a(window).off("resize",this.sizeOverlay);a("#lightbox").fadeOut(this.options.fadeDuration);a("#lightboxOverlay").fadeOut(this.options.fadeDuration);return a("select, object, embed").css({visibility:"visible"})};return d})();a(function(){var e,d;d=new c;return e=new b(d)})}).call(this);